/*! For license information please see 576.15f435ac.chunk.js.LICENSE.txt */
"use strict";(self.webpackChunkalgo_duo_frontend=self.webpackChunkalgo_duo_frontend||[]).push([[576],{576:(e,t,a)=>{a.r(t),a.d(t,{default:()=>T});var n=a(578),i=a(533),s=a(699),r=a(787);const d={easy:"medium",medium:"hard",hard:"hard"},l={easy:"easy",medium:"easy",hard:"medium"};function c(e,t){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.3;return null==e||Number.isNaN(e)?t:a*t+(1-a)*e}async function o(e){var t,a;const i=(0,r.H9)(s.db,"attempts",e.attemptId),o=await(0,r.x7)(i);if(!o.exists())throw new Error("Attempt not found");const u=new Date,m=o.data(),p=(null===(t=m.startedAt)||void 0===t||null===(a=t.toDate)||void 0===a?void 0:a.call(t))||m.startedAt||u,f=Math.max(0,Math.round((u.getTime()-new Date(p).getTime())/1e3));await(0,r.mZ)(i,{endedAt:u,timeTakenSec:f,finalCorrect:e.finalCorrect,wasSkipped:!!e.wasSkipped,updated_at:(0,r.O5)()}),await async function(e){var t,a,n,i;const o=(0,r.H9)(s.db,"users",e.userId,"topic_stats",e.topic),u=await(0,r.x7)(o),m=u.exists()?u.data():null,p=(null!==(t=null===m||void 0===m?void 0:m.attempts)&&void 0!==t?t:0)+1,f=(null!==(a=null===m||void 0===m?void 0:m.correct)&&void 0!==a?a:0)+(e.finalCorrect?1:0),v=c(null===m||void 0===m?void 0:m.accuracyEma,e.finalCorrect?1:0,.3),y=c(null===m||void 0===m?void 0:m.avgTimeSecEma,e.timeTakenSec,.3),g=e.finalCorrect?0:Math.min(10,(null!==(n=null===m||void 0===m?void 0:m.recentFailures)&&void 0!==n?n:0)+1);let h=(null===m||void 0===m?void 0:m.currentDifficulty)||e.currentDifficulty||"easy";g>=3?h=l[h]:v>=.8&&y<=(null!==(i=null===m||void 0===m?void 0:m.avgTimeSecEma)&&void 0!==i?i:e.timeTakenSec)&&(h=d[h]);return await(0,r.BN)(o,{userId:e.userId,topic:e.topic,accuracyEma:v,avgTimeSecEma:y,attempts:p,correct:f,recentFailures:g,currentDifficulty:h,lastUpdated:(0,r.O5)()},{merge:!0}),{id:e.topic,userId:e.userId,topic:e.topic,accuracyEma:v,avgTimeSecEma:y,attempts:p,correct:f,recentFailures:g,currentDifficulty:h,lastUpdated:new Date}}({userId:m.userId,topic:m.topic,currentDifficulty:m.difficulty,finalCorrect:e.finalCorrect,timeTakenSec:f,wasSkipped:!!e.wasSkipped});const v=(await(0,r.x7)(i)).data();return function(e){var t,a,n,i,s,r,d,l;return{id:e.id,userId:e.userId,questionId:e.questionId,topic:e.topic,difficulty:e.difficulty,language:null!==(t=e.language)&&void 0!==t?t:void 0,startedAt:(null===(a=e.startedAt)||void 0===a||null===(n=a.toDate)||void 0===n?void 0:n.call(a))||e.startedAt,endedAt:(null===(i=e.endedAt)||void 0===i||null===(s=i.toDate)||void 0===s?void 0:s.call(i))||e.endedAt||null,timeTakenSec:null!==(r=e.timeTakenSec)&&void 0!==r?r:void 0,wrongAttempts:null!==(d=e.wrongAttempts)&&void 0!==d?d:0,finalCorrect:!!e.finalCorrect,wasSkipped:!!e.wasSkipped,errorTypes:e.errorTypes||[],code:null!==(l=e.code)&&void 0!==l?l:void 0,hintTiersUsed:e.hintTiersUsed||[]}}((0,n.A)({id:e.attemptId},v))}const u={easy:["easy","medium"],medium:["easy","medium","hard"],hard:["medium","hard"]};async function m(e,t){const a=await async function(e,t){if(t)return t;const a=await(0,r.GG)((0,r.rJ)(s.db,"users",e,"topic_stats")),i=a.docs.map(e=>(0,n.A)({id:e.id},e.data()));return 0===i.length?"arrays":(i.sort((e,t)=>{var a,n;return(null!==(a=e.accuracyEma)&&void 0!==a?a:0)-(null!==(n=t.accuracyEma)&&void 0!==n?n:0)}),i[0].topic||i[0].id||"arrays")}(e,t);if(!a)return null;const i=await async function(e,t){var a,n,i,d,l,c,o;const u=(0,r.H9)(s.db,"users",e,"topic_stats",t),m=await(0,r.x7)(u);if(!m.exists())return null;const p=m.data();return{id:t,userId:e,topic:t,accuracyEma:null!==(a=p.accuracyEma)&&void 0!==a?a:0,avgTimeSecEma:null!==(n=p.avgTimeSecEma)&&void 0!==n?n:0,attempts:null!==(i=p.attempts)&&void 0!==i?i:0,correct:null!==(d=p.correct)&&void 0!==d?d:0,recentFailures:null!==(l=p.recentFailures)&&void 0!==l?l:0,currentDifficulty:p.currentDifficulty||"easy",lastUpdated:(null===(c=p.lastUpdated)||void 0===c||null===(o=c.toDate)||void 0===o?void 0:o.call(c))||p.lastUpdated||new Date}}(e,a),d=(null===i||void 0===i?void 0:i.currentDifficulty)||"easy",l=u[d],c=(await(0,r.GG)((0,r.P)((0,r.rJ)(s.db,"questions"),(0,r._M)("topic","==",a)))).docs.map(e=>(0,n.A)({id:e.id},e.data())).filter(e=>l.includes(e.difficulty));if(0===c.length)return null;const o=await async function(e){const t=await(0,r.GG)((0,r.rJ)(s.db,"users",e,"recent_questions")),a={};for(const s of t.docs){var n,i;const e=s.data(),t=(null===(n=e.lastSeen)||void 0===n||null===(i=n.toDate)||void 0===i?void 0:i.call(n))||e.lastSeen;t&&(a[s.id]=t)}return a}(e),m=c.map(e=>{var t;const a=e.difficulty===d?1:0,n=o[e.id],i=n?function(e){const t=Date.now(),a=new Date(e).getTime(),n=(t-a)/36e5;return Math.max(0,1-Math.min(1,n/24))}(n):0;return{q:e,score:1*a+.3*((null===(t=e.tags)||void 0===t?void 0:t.length)||0)-.5*i}});m.sort((e,t)=>t.score-e.score);const p=m[0].q;return await async function(e){const t=(0,r.H9)(s.db,"users",e.userId,"recent_questions",e.questionId);await(0,r.BN)(t,{lastSeen:(0,r.O5)()},{merge:!0})}({userId:e,questionId:p.id}),{questionId:p.id,title:p.title,topic:p.topic,difficulty:p.difficulty}}function p(e){const t=["You're on the right track!","Great effort! Try a smaller example.","Each attempt builds intuition\u2014keep going.","Almost there! Check edge cases."];return t[Math.min(e-1,t.length-1)]}async function f(e){var t;const a=await(0,r.x7)((0,r.H9)(s.db,"questions",e.questionId));if(!a.exists())throw new Error("Question not found");const n=a.data(),i=Math.min(Math.max(e.attemptNumber,1),4);if(i>=2){const t=await async function(e){var t,a;const n=null===(t={})||void 0===t||null===(a=t.env)||void 0===a?void 0:a.VITE_HINTS_FUNCTION_URL;if(!n)return null;try{const t=await fetch(n,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});return t.ok&&(await t.json()).hint||null}catch(i){return null}}({question:{title:n.title,statement:n.description,hints:n.hints},userContext:{language:e.language,errorTypes:e.errorTypes},tier:i});if(t)return{hint:t,tier:i,isLastHint:i>=4,encouragement:p(e.attemptNumber)}}return{hint:function(e){const{errorTypes:t=[],language:a}=e;if(t.includes("index_out_of_bounds"))return"java"===(null===a||void 0===a?void 0:a.toLowerCase())?"Remember: arrays are 0-indexed in Java; the last valid index is length-1.":"Check your indices: arrays are 0-indexed; avoid accessing negative or length index.";if(t.includes("off_by_one"))return"Check loop bounds and inclusive/exclusive conditions; try printing for a 2-3 element input.";const n=Math.max(0,Math.min(e.attemptNumber-1,e.hints.length-1));return e.hints[n]||"Break the problem into smaller subproblems and verify each with a tiny test."}({hints:n.hints||[],attemptNumber:e.attemptNumber,errorTypes:e.errorTypes,language:e.language}),tier:i,isLastHint:i>=((null===(t=n.hints)||void 0===t?void 0:t.length)||3),encouragement:p(e.attemptNumber)}}function v(e){const[t,a]=(0,i.useState)(null),d=(0,i.useRef)(0);return{beginAttempt:(0,i.useCallback)(async t=>{const n=await async function(e){const t=(0,r.rJ)(s.db,"attempts"),a=new Date;return(await(0,r.gS)(t,{userId:e.userId,questionId:e.questionId,topic:e.topic,difficulty:e.difficulty,language:e.language||null,startedAt:a,endedAt:null,timeTakenSec:null,wrongAttempts:0,finalCorrect:!1,wasSkipped:!1,errorTypes:[],hintTiersUsed:[],created_at:(0,r.O5)(),updated_at:(0,r.O5)()})).id}({userId:e,questionId:t.id,topic:t.topic,difficulty:t.difficulty,language:t.language});return a(n),d.current=0,n},[e]),wrongSubmission:(0,i.useCallback)(async e=>{t&&(d.current+=1,await async function(e){var t,a;const n=(0,r.H9)(s.db,"attempts",e.attemptId),i=await(0,r.x7)(n);if(!i.exists())throw new Error("Attempt not found");const d=i.data(),l=(d.wrongAttempts||0)+1,c=Array.from(new Set([...d.errorTypes||[],...e.errorTypes||[]])),o=[...d.hintTiersUsed||[],...e.hintTierUsed?[e.hintTierUsed]:[]];await(0,r.mZ)(n,{wrongAttempts:l,errorTypes:c,code:null!==(t=null!==(a=e.code)&&void 0!==a?a:d.code)&&void 0!==t?t:null,hintTiersUsed:o,updated_at:(0,r.O5)()})}((0,n.A)({attemptId:t},e)))},[t]),finishAttempt:(0,i.useCallback)(async e=>{if(!t)return null;const n=await o({attemptId:t,finalCorrect:e.finalCorrect,wasSkipped:e.wasSkipped});return a(null),d.current=0,n},[t]),requestHint:(0,i.useCallback)(async(a,n)=>{const i=Math.max(1,d.current+1);return f({questionId:a.id,userId:e,attemptId:t||"na",attemptNumber:i,errorTypes:n,language:a.language})},[e,t]),nextProblem:(0,i.useCallback)(async t=>m(e,t),[e]),currentAttemptId:t}}var y=a(651),g=a(356),h=a(736),x=a(633),b=a(256);const w=(0,b.A)("circle-check",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]]),N=(0,b.A)("skip-forward",[["path",{d:"M21 4v16",key:"7j8fe9"}],["path",{d:"M6.029 4.285A2 2 0 0 0 3 6v12a2 2 0 0 0 3.029 1.715l9.997-5.998a2 2 0 0 0 .003-3.432z",key:"zs4d6"}]]);var j=a(683),k=a(465);const S="function solve(input) {\n  // TODO: implement\n  return null;\n}";function T(){const{user:e}=(0,y.A)(),t=null===e||void 0===e?void 0:e.uid,{beginAttempt:a,wrongSubmission:d,finishAttempt:l,requestHint:c,nextProblem:o,currentAttemptId:u}=v(t||"anon"),[m,p]=(0,i.useState)(!1),[f,b]=(0,i.useState)(null),[T,A]=(0,i.useState)(S),[I,_]=(0,i.useState)([]),[q,D]=(0,i.useState)(null),[E,O]=(0,i.useState)([]),H=(0,i.useCallback)(async()=>{if(t){p(!0),_([]),D(null),O([]);try{const e=await o();if(!e)return void b(null);const t=(await(0,r.x7)((0,r.H9)(s.db,"questions",e.questionId))).data(),i=(0,n.A)({id:e.questionId},t);b(i),A(i.starterCode||S),await a({id:e.questionId,topic:i.topic,difficulty:i.difficulty,language:"javascript"})}finally{p(!1)}}},[t,o,a]);(0,i.useEffect)(()=>{H()},[t,H]);const M=(0,i.useCallback)(()=>{if(!f)return;const e=f.testCases||[],t='"use strict";\n'.concat(T,"\nreturn (typeof solve !== 'undefined') ? solve : undefined;");let a;try{if(a=new Function(t)(),"function"!==typeof a)throw new Error("Define function solve(input) in your code.")}catch(s){return _([{name:"Compile",passed:!1,expected:"No error",received:"Error",error:(null===s||void 0===s?void 0:s.message)||String(s)}]),void O(C((null===s||void 0===s?void 0:s.message)||""))}const n=[];let i=[];for(let r=0;r<e.length;r++){const t=e[r];try{const e=a(t.input),s=JSON.stringify(e)===JSON.stringify(t.expectedOutput);n.push({name:"Test ".concat(r+1),passed:s,expected:t.expectedOutput,received:e}),s||(i=i.concat(C("mismatch")))}catch(s){n.push({name:"Test ".concat(r+1),passed:!1,expected:t.expectedOutput,received:void 0,error:(null===s||void 0===s?void 0:s.message)||String(s)}),i=i.concat(C((null===s||void 0===s?void 0:s.message)||""))}}_(n),O(Array.from(new Set(i)))},[f,T]),U=(0,i.useCallback)(async()=>{if(!f)return;const e=await c({id:f.id,language:"javascript"},E);D(e),await d({errorTypes:E,hintTierUsed:e.tier})},[f,E,c,d]),J=(0,i.useCallback)(async()=>{await l({finalCorrect:!0}),await H()},[l,H]),G=(0,i.useCallback)(async()=>{await d({errorTypes:E})},[d,E]),L=(0,i.useCallback)(async()=>{await l({finalCorrect:!1,wasSkipped:!0}),await H()},[l,H]);return t?(0,k.jsx)("div",{className:"min-h-screen bg-gray-900 text-white px-6 py-6",children:(0,k.jsxs)("div",{className:"max-w-5xl mx-auto space-y-4",children:[(0,k.jsxs)("div",{className:"flex items-center justify-between",children:[(0,k.jsx)("h1",{className:"text-2xl font-bold",children:"Tutor Dev"}),(0,k.jsx)("button",{onClick:H,disabled:m,className:"px-3 py-1.5 rounded bg-gray-700 hover:bg-gray-600 text-sm",children:m?"Loading...":"Next Problem"})]}),f?(0,k.jsxs)("div",{className:"space-y-4",children:[(0,k.jsxs)("div",{className:"bg-gray-800/60 rounded-xl border border-gray-700/60 p-4",children:[(0,k.jsxs)("div",{className:"text-sm text-gray-400 mb-1",children:[f.topic," \u2022 ",f.difficulty]}),(0,k.jsx)("div",{className:"text-xl font-semibold",children:f.title}),(0,k.jsx)("p",{className:"text-gray-300 mt-2",children:f.description})]}),(0,k.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[(0,k.jsxs)("div",{className:"bg-gray-800/60 rounded-xl border border-gray-700/60",children:[(0,k.jsxs)("div",{className:"flex items-center justify-between p-3 border-b border-gray-700/60",children:[(0,k.jsx)("span",{className:"text-sm text-gray-300",children:"Editor (define solve(input))"}),(0,k.jsxs)("div",{className:"flex gap-2",children:[(0,k.jsxs)("button",{onClick:M,className:"px-3 py-1.5 rounded bg-emerald-600 hover:bg-emerald-700 text-sm flex items-center gap-1",children:[(0,k.jsx)(h.A,{className:"w-4 h-4"}),"Run"]}),(0,k.jsxs)("button",{onClick:G,className:"px-3 py-1.5 rounded bg-amber-600 hover:bg-amber-700 text-sm flex items-center gap-1",children:[(0,k.jsx)(x.A,{className:"w-4 h-4"}),"Wrong"]}),(0,k.jsxs)("button",{onClick:J,className:"px-3 py-1.5 rounded bg-blue-600 hover:bg-blue-700 text-sm flex items-center gap-1",children:[(0,k.jsx)(w,{className:"w-4 h-4"}),"Mark Correct"]}),(0,k.jsxs)("button",{onClick:L,className:"px-3 py-1.5 rounded bg-gray-600 hover:bg-gray-500 text-sm flex items-center gap-1",children:[(0,k.jsx)(N,{className:"w-4 h-4"}),"Skip"]})]})]}),(0,k.jsx)("div",{className:"h-[400px]",children:(0,k.jsx)(g.Ay,{height:"100%",defaultLanguage:"javascript",theme:"vs-dark",value:T,onChange:e=>A(e||""),options:{fontSize:14,minimap:{enabled:!1}}})})]}),(0,k.jsxs)("div",{className:"space-y-4",children:[(0,k.jsxs)("div",{className:"bg-gray-800/60 rounded-xl border border-gray-700/60 p-4",children:[(0,k.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,k.jsx)(j.A,{className:"w-5 h-5 text-yellow-400"}),(0,k.jsx)("span",{className:"font-medium",children:"Hint"})]}),q?(0,k.jsxs)("div",{className:"text-sm text-gray-200",children:[(0,k.jsxs)("div",{className:"mb-1 text-gray-400",children:["Tier ",q.tier,q.isLastHint?" \u2022 last":""]}),(0,k.jsx)("div",{className:"mb-2",children:q.hint}),q.encouragement&&(0,k.jsx)("div",{className:"text-gray-400",children:q.encouragement})]}):(0,k.jsx)("button",{onClick:U,className:"px-3 py-1.5 rounded bg-yellow-600 hover:bg-yellow-700 text-sm",children:"Get Hint"})]}),(0,k.jsxs)("div",{className:"bg-gray-800/60 rounded-xl border border-gray-700/60 p-4",children:[(0,k.jsx)("div",{className:"font-medium mb-2",children:"Results"}),(0,k.jsxs)("div",{className:"space-y-2 text-sm",children:[0===I.length&&(0,k.jsx)("div",{className:"text-gray-400",children:"No runs yet."}),I.map((e,t)=>(0,k.jsxs)("div",{className:"p-2 rounded ".concat(e.passed?"bg-emerald-900/30 border border-emerald-700/40":"bg-red-900/30 border border-red-700/40"),children:[(0,k.jsxs)("div",{className:"flex justify-between",children:[(0,k.jsx)("span",{children:e.name}),(0,k.jsx)("span",{children:e.passed?"\u2705":"\u274c"})]}),!e.passed&&(0,k.jsx)("div",{className:"mt-1 text-gray-300",children:e.error?(0,k.jsxs)("div",{children:["Error: ",e.error]}):(0,k.jsxs)("div",{children:["Expected: ",JSON.stringify(e.expected)," \u2022 Received: ",JSON.stringify(e.received)]})})]},t))]}),E.length>0&&(0,k.jsxs)("div",{className:"text-xs text-gray-400 mt-3",children:["Detected errors: ",E.join(", ")]})]})]})]})]}):(0,k.jsx)("div",{className:"text-gray-400",children:"No suitable question found. Seed questions and try again."})]})}):(0,k.jsx)("div",{className:"p-6 text-red-300",children:"Sign in required to demo Tutor."})}function C(e){const t=[],a=(e||"").toLowerCase();return(a.includes("out of bounds")||a.includes("length")&&a.includes("index"))&&t.push("index_out_of_bounds"),(a.includes("undefined")||a.includes("null"))&&t.push("null_ref"),a.includes("rangeerror")&&t.push("infinite_loop"),a.includes("mismatch")&&t.push("wrong_answer"),(a.includes("off by one")||a.includes("boundary"))&&t.push("off_by_one"),Array.from(new Set(t))}}}]);
//# sourceMappingURL=576.15f435ac.chunk.js.map